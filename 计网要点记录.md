[TOC]



# 计网第一课要点记录

## 1.互联网标准 Internet standard

RFC: Request For Comments 请求评论

IETF:国际互联网工程任务组（The Internet Engineering Task Force，简称 IETF）



## 2.什么是network edge？ 什么是 network core？

### 网络边缘：

1. 端系统

2. 接入网（access networks）

   接入网被形象地称为“最后一公里” 常见有：**铜线**（普通电话线）接入、**光纤**接入（FTTH）、**光纤同轴电缆**（HFC）（有线电视电缆）混合接入和无线接入等几种方式

   ![接入网](D:\学习笔记\计算机网络\重要图片图床\接入网.png)

3. links 链路

### 网络核心：

1. packet switching
2. circuit switching
3. network structure

核心网络的功能： routing and forwarding 路由和跳转

## 3.时延

### 1.传输时延 transmission delay

指的是**最后一公里**地时延 计算公式为L/R ，由于一个端到端的传输时延要走两个“最后一公里” 所以**端到端** 的传输时延为 2 * L/R。

### 2.排队时延 queuing delay

当 到达速率 > 传输时延时，会发生排队时延

### 3.处理时延 process delay

检验比特错误，决定输出链路等处理所带来的时延

### 4. 传播时延 propagation delay

在长长的物理介质上传输的时延 ， 请注意区分 **传输时延**



## 4.ISP

全称为：Internet service provider 它的出现是为了减少不同接入网互联时带来的复杂， ISP 的作用是“网络的网络”

![ISP](D:\学习笔记\计算机网络\重要图片图床\ISP.png)



IXP :  Internet Exchange Point **因特网交换点**





# 计网第二课要点记录

## 1.网络协议栈



![协议栈](D:\学习笔记\计算机网络\重要图片图床\协议栈.png)

## 2. 判断Queuing delay 的强度

![排队时延强度量化](D:\学习笔记\计算机网络\重要图片图床\排队时延强度量化.png)

a 一般作为一个常数题目会直接给出   

L * a 的量纲表示 每秒**n 个包**总共包含的bit数



## 3. 吞吐量 throughput

throughput 的单位实际上是rate（bits/time unit） throughput 的值取决于**几个速率中最小**的那个

下图为一个例子

![吞吐量](D:\学习笔记\计算机网络\重要图片图床\吞吐量.png)



# 计网第三课要点记录

## 1. 应用层的结构

1. client - server
2. peer-to-peer（P2P）



##  2. socket 要点

1. 存在于**应用层**与**运输层**之间

   

## 3. TCP UDP 分别提供什么， 不提供什么

![](D:\学习笔记\计算机网络\重要图片图床\TCP UDP、.png)

### TCP 提供：

稳定传输 reliable transport

流量控制 flow control

注： 流量控制即指 去trade-off 一次发多少个MSS(**Maximum Segment Size，TCP一次传输发送的最大数据段长度**)

拥塞控制 congestion control



**TCP 是面向连接的！！！！**

### TCP 不提供：

时间保证（比如多长时间内一定交付）

最小吞吐量

安全

### UDP 提供：

**不可靠**的数据传输



### UDP 不提供：

可靠数据传输

流量控制

拥塞控制

时间保证

吞吐量

安全

**面向连接**



## 4.使用TCP/UDP 的应用

![应用与协议](D:\学习笔记\计算机网络\重要图片图床\应用与协议.png)

文件 ， 文本 ， 邮件 ， web(即**SMTP**、**HTTP**、**FTP** ) 全是TCP

多媒体，视频电话 ，**DNS** 可TCP ，可UDP

SNMP(简单网络管理协议) 使用UDP

DNS 可以认为使用**UDP**

DHCP 使用**UDP**



## 5. HTTP 知识点

### overview

全称：hypertext transfer protocol 超文本传输协议

是一种stateless 协议 ， 即不会保存用户之前的状态与信息

使用**80**端口



### 连接方式

HTTP 连接分为 **持续链接persistent HTTP ** 和 **非持续链接 non-persistent HTTP**

持续连接： 多个对象可以通过一个TCP 连接进行传输

非持续连接：一个连接最多传输一个对象 ， 每一次传输结束TCP连接就会关闭

​					对于每个请求，非持久HTTP将具有**不同的套接字**



###  HTTP响应码

200 - OK

301 - Moved Permanently

400 - Bad Request

404 - Not Found

505 - HTTP Version



## Cookies 和 Cache 的区别

### 1. Cookies 的用途

![cookie](D:\学习笔记\计算机网络\重要图片图床\cookie.png)

验证、购物车、推荐、email保持绘画



### 2. Cache

把常用的网页 **缓存到proxy service**中，如果proxy中有缓存，就直接返回object，如果没有，再去请求。



## 6.电子邮件知识点总结

### 1. 常见的电子邮件协议

SMTP - 简单邮件传输协议 占用端口位**25**  使用TCP 持续连接persistent connection

POP3 - 邮局协议第三个版本 占用端口号 **110**

IMAP - 交互式邮件存取协议

### 2. 上述协议的作用 & 位置

![电子邮件协议作用在什么地方](D:\学习笔记\计算机网络\重要图片图床\电子邮件协议作用在什么地方.png)

POP3 和IMAP 的区别：

POP3 一旦用户下载后，服务器就不再保存这个邮件

IMAP 则把邮件长久的存储在服务器中，用户的更改可以更新到服务器里



## 7. DNS 知识点总结

### 1. 把网站的名字 映射成 ip地址



### 2. 特点

1. 是应用层的协议 和HTTP SMTP IMAP POP3 一样都是应用层协议
2. 占用端口 **53**



### 3.一个DNS 查询流程的例子

![DNS查询](D:\学习笔记\计算机网络\重要图片图床\DNS查询.png)

具体流程为：以www.amazon.com 为例

查询根DNS服务器  --- 得到 .com DNS 服务器

查询 .com DNS 服务器 --- 得到 amazon.com DNS 服务器地址

查询amazon.com DNS 服务器 --- 得到 www.amazon.com 的IP地址

#### TLD

TLD(top-level domain)顶级域名 维护了诸如com , org , job , edu 等 以及顶级国家域名 cn , au , uk

由 **Network Solutions** 这一组织维护



#### authoritative DNS server

authoritative DNS servers 通常由组织所提供 ， 由组织维护



### 迭代查询 VS 递归查询

首先，我们要了解本地DNS server 的作用 ， 它起一个**代理**的作用 为一个区域内的所有主机提供服务



**迭代查询** 关键看**是不是本地查所有**。

**递归查询** 关键看**是不是一个查一个**





# 计网第五课要点记录

-------------------------------------------这节课学传输层---------------------------------------------

**一个宏观上的认识**：

*传输层提供逻辑上**进程与进程**间的通信*

*网络层提供逻辑上**主机与主机**见的通信*

## 1. 传输层数据单元

传输层数据单元是**Segment** 中文译为**报文段** ，是由上层应用层的Message 分割来的



## 2. TCP/UDP 的特点

### TCP

面向连接

流量控制

拥塞控制

### UDP

朴实无华(No-frills)的尽最大努力传播



**注意**： 二者都不提供**时延保证**以及**带宽保证**



## 3.多路复用(multiplexing)和多路分解(demultiplexing）

多路复用：处理来自不同套接字的数据，并分别给他们加上合适的首部(Header)

多路分解：通过头部信息解包，然后交付给正确的套接字



TCP 的socket 被唯一个**四元组**唯一标识着：

源IP、源端口号、目的IP、目的端口号



UDP socket 是一个**二元组**：

**源端口号**、**目的端口号**



**对于每个请求，非持久HTTP将具有不同的套接字**



## 4.UDP 知识点总结



### 1. 使用UDP 的应用层协议

DNS、SNMP



### 2. 使用UDP 如何进行可靠数据传输

答：在应用层建立检验机制 或 在根据不同的应用特点建立恢复机制



### 3.UDP 报文段的Header

![UDP头部](D:\学习笔记\计算机网络\重要图片图床\UDP头部.png)

UDP的优点：

没有建立连接的过程，减少了delay

更简单 ， 没有连接状态的维护

更小的Header Size

没有拥塞控制，这意味着，包可以更快地“发射”出去



## 5. rdt 版本演进 



### rdt1.0

完美的信道 没有**比特错误**和**丢包**

所以不需要建立恢复机制



### rdt2.0

会遇到比特翻转这样的错误，但不会考虑**丢包(package loss)**

#### rdt2.0

接收端回馈ACK OR NAK 来反馈是不是接收到正确的segment

**致命缺陷**：ACK OR NAK 同样可能发生错误 ， 这样可能导致**发重复的包**。



#### rdt2.1

使用Sequence number(0 ,1)交替



#### rdt2.2

取消NAK ，因为ACK 序号等效NAK，故取消



### rdt3.0

在既有**比特错误**和**丢包**的信道上传输数据

新的方法：

-设置一个计时器(timer)



rdt3.0的行为如下图所示：

![rdt3.0的行为](D:\学习笔记\计算机网络\重要图片图床\rdt3.0的行为.png)



rdt3.0 固然可以应对上述情况，但是效率太低，这里有一个计算是算**用户传输文件的利用率utilization**



要记住公式！！！！

![rdt利用率](D:\学习笔记\计算机网络\重要图片图床\rdt利用率.png)





#### 采用**流水线(pipeline)方法**增大利用率

流水线方法有两个：**Go-back-N** 和 **Selective Search**

![流水线协议](D:\学习笔记\计算机网络\重要图片图床\流水线协议.png)

#### 回退n步的细节

返回的ack只能是**严格连续递增**的，ack 包之间没有间隔

对一个窗口内**最早发出的包** 设定计时器，超时则**重新传送**窗口内所有的packet。



GBN工作流程如图所示：

![GBN](D:\学习笔记\计算机网络\重要图片图床\GBN.png)

![GBN_Sender](D:\学习笔记\计算机网络\重要图片图床\GBN_Sender.png)

#### 选择性重发的细节

对一个窗口内的每一个packet 发单独的ack

对每一个packet维护一个**计时器**



## TCP FLow Control & Congestion Control

### FLow Control

![](D:\学习笔记\计算机网络\重要图片图床\TcpFlowControl.png)

**rwnd** 用来描述 free buffer space的大小，它是receiver端回传给sender 的报文里的数据，用来预防buffer 的溢出 



### retransmission 的三种情景

![重传输1](D:\学习笔记\计算机网络\重要图片图床\重传输1.png)

图一：没有收到ack 意味着**发送端滑窗不能向后移动**所以发的Seq 还是92

图二：再timeout以内，发端没有收到ack ， 意味着发端的滑动窗口不能后移，所以重发时还是Seq = 92，但是看收端， 以累计ack的特点， 收端实打实的收到了累计的ack ，所以最后一次给发端的**ACK是120**



![重传输2](D:\学习笔记\计算机网络\重要图片图床\重传输2.png)

图三：下一个Seq的值 只与它上次的ACK 挂钩 ， 一个重要前提是 ACK 是**累计确认的**



### TCP fast retransmission（tcp 快速重传）

当sender 收到相同的**3** 个ACK 时， 把**unack的全部重传**



# 计网第七课、第八课、第九课知识点总结

总述：这几节课是将网络层的 ， 分别介绍了网络层的 数据平面和 控制平面

Data Plane：专注于一个数据报在一个路由中是如何被处理的

Control Plane：从宏观上认识路由过程，数据报是如何跳转的

  - traditional routing algorithm：per-routing control 就是每个路由器运行自己的路由算法

  - SDN 软件定义网络， 远程服务器来和每个路由的控制代理(CA)进行交互

    

## 1. Data Plane

### 路由器的结构：

1. routing processor  - 软件 ，运行路由选路算法

2. input port -硬件，由三部分组成

   ​	2.1 line termination  做bit 层面的接受

   ​	2.2 link layer p'rotocal  根据不同的链路层协议组装成帧

   ​	2.3 look up forwarding 部分， **在这里每一个数据报就已经知道了自己的下一跳在哪了** 

3. switching fabric 用于实现把数据包分到不同的出口  基于**crossbar** 的高效电路结构

4. output port 是input 的逆过程，唯一需要注意的是，output queueing，人们研究了多种算法 合理安排数据报怎么从排队中出去 

   它不一定就是一个简单的队列，它可能是，比如多个带不同权重的队列，类似进程调度



### IP 数据报的格式

![ip数据报](D:\学习笔记\计算机网络\重要图片图床\ip数据报.png)

我们可以看到头部最少**20**个字节，还有40个字节是可选的(optional)

在type of service 字段，我们可以看出ip 是best-effort 类型的

每一跳 time to live字段就减少一，当减少至0时，就丢弃这个数据报





由于链路层有**MTU（Max Transfer Size）** 所以IP数据报经常需要 fragmentation ， 并在 ***目的端***  进行组装(Reassembly) 务必记住是在最后的**终点端系统** 进行的组装

这里有***计算题***需要掌握

![ip数据报的分包](D:\学习笔记\计算机网络\重要图片图床\ip数据报的分包.png)



### 子网（Subnet）

给定一个IP号，它被分为了两部分： Subnet part 和host part

**子网** 就是subnet part **相同** 的一组ip



子网的记法：ip + 子网掩码   斜杠记法（xxxx.xxxx.xxxx.xxxx/#)   也就是CIDR(Class InterDomin Routing) **无类别域间路由技术**

notice：#代表一个数字，这个数字表示子网掩码中有**连续的1的个数**



子网掩码的用法：使用**子网掩码** 与 **ip**号 **按位** 进行 **与运算**，得到的运算结果 就是这一集合的**子网号**



IP 的 ABC类分类（已经是被淘汰的技术了），有的题会通过给你一个ip 通过其**前8个bit**(如下图所示)让你判断出它的类型，从而得到它的子网掩码(Mask)

![IP的abc类网址](D:\学习笔记\计算机网络\重要图片图床\IP的abc类网址.png)

### NAT（Network Address Transition）技术

#### 什么是私有IP地址

![私有IP](D:\学习笔记\计算机网络\重要图片图床\私有IP.png)

#### NAT的工作流程：

![NAT工作流程](D:\学习笔记\计算机网络\重要图片图床\NAT工作流程.png)

1.首先定义一个私有IP到一个因特网的ip

2.NAT路由器 把一个**（私有IP，端口号0）** 映射成**（因特网公网IP，端口号1）** NOTICE：两个端口号不同，注意看图！！！，接着，在NAT transition table 里记录这个映射关系

按常识，我们只需要给路由器的网卡一个设置成非私有IP，一个设置成私有IP就彳亍。

3.位于Internet的服务器给**路由器的因特网公网IP网卡口**回复

4对照**转换表**找到（私有IP，端口号0）把包传递过去



#### 它的争议点在哪里：

用到了port number，这是运输层用的，这样破坏了分层带来的封装性。

违反了端到端（end to end）规则



### 怎样得到ip 地址

#### 如何得到一个子网号？

 向你在的ISP 提供者申请

#### 那ISP 怎么得到一大块ip地址： 

向**ICANN**申请

ICANN 的作用：
 	1. 分配地址
 	2. 管理DNS
 	3. 分配域名，解决争端



#### 一个主机如何得到自己的ip？

通过操作系统的接口写入一个静态的ip(不常见)

通过**DHCP**（Dynamic Host Configuration Protocol）得到一个动态的ip地址，  它在运输层使用UDP

DHCP 还可以返回 子网掩码， DNS的名字和ip，第一跳路由的地址



DHCP 工作流程 ， 注意其消息全是 **广播** 类型

![DHCP](D:\学习笔记\计算机网络\重要图片图床\DHCP.png)

## Control Plane

在这个平面，我们将介绍一些路由选择的知识，

一个重要的先决条件：**路由协议是找一条good的路径** 而不是找一个best的路径





### 什么是AS（自治系统）

一组路由聚合的一个集合成的系统就是一个AS



#### intra-As routing

1. 是一个as内主机间的路由
2. 一个as内的**所有** 路由需要使用**相同的选路算法，不同的as间可以选用不同的
3. gateway 就是一个抽象概念，实际上就是一个路由器，一个既连着自己as内的路由器，由连着别的as的路由器就是一个gateway



#### inter-As routing 

不同as间的路由



### Intra -AS Routing Protocol

RIP - Routing Information Protocol    DV  distinct vector

IGRP - Interior Gateway Routing Protocol DV

OSPF - Open Shortest Path First   Link State

IS-IS



#### Hierarchical OSPF

![OSPF](D:\学习笔记\计算机网络\重要图片图床\OSPF.png)

注意区分area border router 和 boundary router

前者是**每个area** 的入口

后者是**每个as** 的入口

backbone routers 是连接所有area的一个阶层



#### Inter - AS Routing（BGP）

(Routing among ISPs)



简单介绍一下**BGP**（Border Gateway Protocol）

它基于 Distinct Vector 算法 ， 连接了不同的AS

其上层使用**TCP**连接



eBGP  和 iBGP

![bgp](D:\学习笔记\计算机网络\重要图片图床\bgp.png)

gateway 运行了i 的 和 e 的

其中e 从其他AS内得到某个子网的可达信息

i 把得到的可达信息 告诉自己as内的router



#### BGP里的两个定义

Path：经过的AS组成的一个列表

Next-Hop: 下一个经过的AS


#### BGP工作的流程

1.一个核心思想是BGP是基于**距离向量（distinct vector）**算法的，每一个eBGP可以理解成一个代理，它会给其他AS的eBGP返回一个Path（见上）。

2.一个eBGP的router可能会收到多条Path，所以PATH之间是如何**取舍**的呢？

​	1.本地的**偏好值**（Preference Value），它也会很大程度上参考不同AS（Autonomy System，自治系统）之间参考**政策** （比如在中国不能访问外网）

​	2.最短的AS PATH

​	3.最短的**下一跳AS**也叫做hot potato routing，本质上是一种迭代了一次的***贪心算法***

notice：使用热土豆的情况：到一个路由器有多种不同的路径可供选择。

​	4.一些额外的准则

#### BGP下如何设置路由器的路由表

PPT如下图所示：

![bgp路由表](D:\学习笔记\计算机网络\重要图片图床\bgp路由表.png)

1.通过iBGP，1a 1b 1d 从 **1c** 拿到了 到目的地X经历的**AS PATH**

2.1d 在 OSPF intra-domin(即在每个AS域内)的帮助下，得知到1c 要走 interface1，于是给目的地X 设置其映射（Mapping）为1

3.同理，在OSPF 的帮助下，1a得知自己到1c的一条好路径下一条要走interface2.于是设置路由表一条记录为**“X - 2”**



### ICMP（Internet Control Message Protocol）

1.在主机和路由器之间使用

2.**被封装**进ip数据包中，就是ip数据报的data部分是ICMP报文



# 计网第十一课、十二课知识点总结

综述：讲的是链路层

## Linklayer 提供的服务：

1.把数据报（datagram）封装成帧，注意！！！ 即加**header 也加 trailer** ，这不同意其他的层，这个加尾巴的

2.对信道的接入(学名叫**随机接入random access**)

3.使用MAC地址完成识别src 和 dest

4 ***reliable deliver between nodes ***提供可靠的数据传输



5.提供flow control 、error detection、error correction(不常见)、half-duplex & full-duplex





## Multi access protocol

两种方式：

​	PPP ： 是 point-to-point 是用在拨号上网

​	broadcast：（shared wired or medium）

老式的以太网、HFC（混合光纤同轴电缆,欧美区常见）、802.11 wireless LAN





#### 3种broadcast 的类别

1.partition 把信道按照时隙或信号的频率分割

2.random access 大家一起用一个信道，然后允许碰撞，并有回复数据的机制

3.taking turns  轮流发言



##### 1.partition 的方法

FDMA - frequency division multiple access

把不同的频率 分成几个部分给每个接口用

TDMA - time division multiple access

分成几个时间片，每个接口对时隙的占用体现在 **transmission delay** 上，教材配图如下

![TDMA](D:\学习笔记\计算机网络\重要图片图床\TDMA.png)

##### 2.random access（随机接入）几种协议

本部分介绍**pure aloha** & **slotted aloha**



Pure Aloha：

帧一到网卡口，就发送出去

![purealoha](D:\学习笔记\计算机网络\重要图片图床\purealoha.png)

Slotted Aloha：

![saloha](D:\学习笔记\计算机网络\重要图片图床\saloha.png)





基于上述协议，我们想到了检测冲突

因此我们有了CSMA（Carrier Sense Multi Access）

核心思想就是***Listen Before Talk***

碰撞还是**有可能发生**的因为propagation delay的存在



进一步解决问题，我们有了**CSMA/CD** CD 是collision detection的缩写

​	提供短时间内的碰撞检测

​	碰撞的传输被丢弃

对于有线的传输，这足够了， 对于无线的传输，**CSMA/CA**（collision avoidance）是被使用的



## MAC 介绍



### MAC基本概念

MAC 地址的作用像是快递中“最后一公里的作用“



每一个**网卡（Network Interface Card）** 都有一个LAN地址 即MAC地址，它被烧录进NIC的ROM中

MAC地址是一个48bit（6字节）

企业买走前三个字节，后三个字节自己分配



MAC地址不会随你所处的网络环境改变而改变，因此它是portable(便携)的。



### 与MAC有关的协议ARP（Address Resolution Protocol）

一个LAN中的每个IP节点，即主机，路由器，内部都有一张ARP表 ， 用以映射IP地址到MAC地址， 同时还设有一TTL值。



同一LAN中的ARP 工作流程：

![同一LAN中的ARP](D:\学习笔记\计算机网络\重要图片图床\同一LAN中的ARP.png)



当主机A发现B不在 A本地的ARP表中， A 就 **广播**一个ARP 请求数据包，广播的MAC地址是写死的，就是FF-FF-FF-FF-FF-FF，这个请求数据包是包含目的主机**B的IP地址**的。

每个IP节点都会收到这个ARP请求，但只有IP匹配的节点会**做回复**，它**单独的**给A回复自己的ARP地址以及之后的**数据报（Datagram）**



Routing to Another LAN的情况：

记住上课讲的一句话：***对于这种情况下链路层发送的帧，它封装的IP地址是不会变的，变的是下一跳的MAC地址***





## 广域网



### 以太网技术

在这部分主要介绍以太网（Ethernet）

首先分辨一些概念，广域网就是一个区域很大的网络

以太网是一种**有线的（Wired）**实现技术 ， 对比在无线领域 我们有WLAN （Wiredless） LAN



可以把以太网理解成是一种封装，对物理层各种各样的线路做了封装， 因此**它对上层透明，可以有多种速度选择**，它定义在802.3中

![以太网](D:\学习笔记\计算机网络\重要图片图床\以太网.png)



### 交换机（Switch）

交换机可以看作是多个不同方向的网桥的堆叠



**交换机的特点：**

1.选择性转发

2.对用户透明

3.即插即用（plug-and-play）

4.自学习（self-learning）

5.隔离碰撞域（collision domin）：以太网协议运行在交换机每一个输入链路上，所以每条链路有它自己的碰撞域

6.帧过滤（Frame filter）



自学习算法流程：

![switch自学习](D:\学习笔记\计算机网络\重要图片图床\switch自学习.png)

一句话：表里找不到就每个链路全问一遍，有就直接**selectively**给目的节点就完事了

